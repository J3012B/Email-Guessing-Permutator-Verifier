<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Email Verifier</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0f1117;
      --surface: #1a1d27;
      --surface-hover: #222632;
      --border: #2a2e3b;
      --text: #e4e4e7;
      --text-muted: #8b8d97;
      --accent: #6366f1;
      --accent-hover: #818cf8;
      --green: #22c55e;
      --green-bg: rgba(34, 197, 94, 0.1);
      --red: #ef4444;
      --red-bg: rgba(239, 68, 68, 0.1);
      --yellow: #eab308;
      --yellow-bg: rgba(234, 179, 8, 0.1);
      --radius: 12px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .container {
      width: 100%;
      max-width: 720px;
      padding: 48px 20px 80px;
    }

    header {
      text-align: center;
      margin-bottom: 40px;
    }

    header h1 {
      font-size: 1.75rem;
      font-weight: 700;
      letter-spacing: -0.02em;
      margin-bottom: 8px;
    }

    header p {
      color: var(--text-muted);
      font-size: 0.95rem;
      line-height: 1.5;
    }

    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 28px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .form-group.full {
      grid-column: 1 / -1;
    }

    label {
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
    }

    input {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 11px 14px;
      font-size: 0.95rem;
      color: var(--text);
      outline: none;
      transition: border-color 0.2s;
    }

    input::placeholder { color: #4a4d58; }
    input:focus { border-color: var(--accent); }

    .btn {
      grid-column: 1 / -1;
      margin-top: 4px;
      padding: 13px;
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .btn:hover { background: var(--accent-hover); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }

    .status-bar {
      display: none;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-top: 24px;
      padding: 14px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .status-bar.visible { display: flex; }

    .spinner {
      width: 18px;
      height: 18px;
      border: 2px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .progress-text { font-variant-numeric: tabular-nums; }

    .results {
      margin-top: 24px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .results-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      margin-bottom: 4px;
    }

    .results-header h2 {
      font-size: 1rem;
      font-weight: 600;
    }

    .results-header span {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .result-row {
      display: grid;
      grid-template-columns: 1fr auto auto auto;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      transition: background 0.15s;
    }

    .result-row:hover { background: var(--surface-hover); }

    .result-email {
      font-family: "SF Mono", "Fira Code", "Cascadia Code", monospace;
      font-size: 0.9rem;
      word-break: break-all;
    }

    .badge {
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      white-space: nowrap;
    }

    .badge.deliverable { background: var(--green-bg); color: var(--green); }
    .badge.risky { background: var(--yellow-bg); color: var(--yellow); }
    .badge.undeliverable { background: var(--red-bg); color: var(--red); }
    .badge.error { background: var(--red-bg); color: var(--red); }
    .badge.tier { background: rgba(99, 102, 241, 0.15); color: var(--accent); }

    .score {
      font-size: 0.85rem;
      font-weight: 600;
      font-variant-numeric: tabular-nums;
      min-width: 48px;
      text-align: right;
    }

    .score.high { color: var(--green); }
    .score.medium { color: var(--yellow); }
    .score.low { color: var(--red); }

    .error-msg {
      text-align: center;
      padding: 16px;
      color: var(--red);
      background: var(--red-bg);
      border-radius: var(--radius);
      margin-top: 24px;
      font-size: 0.9rem;
    }

    @media (max-width: 500px) {
      .form-grid { grid-template-columns: 1fr; }
      .form-group.full { grid-column: 1; }
      .btn { grid-column: 1; }
      .result-row { grid-template-columns: 1fr auto; }
      .badge.tier { display: none; }
      .score { display: none; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Outreach Email Verifier</h1>
      <p>Enter a name and company domain to discover and verify probable email addresses.</p>
    </header>

    <form class="card" id="form">
      <div class="form-grid">
        <div class="form-group">
          <label for="firstName">First Name</label>
          <input type="text" id="firstName" placeholder="Jane" required />
        </div>
        <div class="form-group">
          <label for="lastName">Last Name</label>
          <input type="text" id="lastName" placeholder="Smith" required />
        </div>
        <div class="form-group full">
          <label for="domain">Domain</label>
          <input type="text" id="domain" placeholder="acme.com" required />
        </div>
        <button class="btn" type="submit" id="submitBtn">Verify Email Variations</button>
      </div>
    </form>

    <div class="status-bar" id="statusBar">
      <div class="spinner"></div>
      <span class="progress-text" id="statusText">Verifying...</span>
    </div>

    <div id="errorContainer"></div>
    <div id="resultsContainer"></div>
  </div>

  <script>
    const form = document.getElementById("form");
    const submitBtn = document.getElementById("submitBtn");
    const statusBar = document.getElementById("statusBar");
    const statusText = document.getElementById("statusText");
    const errorContainer = document.getElementById("errorContainer");
    const resultsContainer = document.getElementById("resultsContainer");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      errorContainer.innerHTML = "";
      resultsContainer.innerHTML = "";

      const firstName = document.getElementById("firstName").value.trim();
      const lastName = document.getElementById("lastName").value.trim();
      let domain = document.getElementById("domain").value.trim().toLowerCase();

      domain = domain.replace(/^https?:\/\//, "").replace(/^www\./, "").replace(/\/.*$/, "");

      if (!firstName || !lastName || !domain) return;

      submitBtn.disabled = true;
      submitBtn.textContent = "Verifying...";
      statusBar.classList.add("visible");
      statusText.textContent = "Sending variations for verification...";

      try {
        const res = await fetch("/api/verify", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ firstName, lastName, domain }),
        });

        const data = await res.json();

        if (!res.ok) {
          throw new Error(data.error || "Something went wrong");
        }

        statusBar.classList.remove("visible");
        renderResults(data.results, data.apiCallsUsed);
      } catch (err) {
        statusBar.classList.remove("visible");
        errorContainer.innerHTML = `<div class="error-msg">${escapeHtml(err.message)}</div>`;
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Verify Email Variations";
      }
    });

    function renderResults(results, apiCallsUsed) {
      const deliverable = results.filter((r) => !r.error && r.is_deliverable);
      const apiInfo = apiCallsUsed ? ` Â· ${apiCallsUsed} API calls` : '';
      const header = `
        <div class="results-header">
          <h2>Results</h2>
          <span>${deliverable.length} deliverable${apiInfo}</span>
        </div>`;

      const rows = results
        .map((r) => {
          const tierBadge = r.tier ? `<span class="badge tier">Tier ${r.tier}</span>` : '';
          
          if (r.error) {
            return `
              <div class="result-row">
                <span class="result-email">${escapeHtml(r.email)}</span>
                ${tierBadge}
                <span class="badge error">Error</span>
                <span class="score low">--</span>
              </div>`;
          }

          const score = r.score != null ? r.score : 0;
          const scoreClass = score >= 0.7 ? "high" : score >= 0.4 ? "medium" : "low";
          const badgeClass = r.is_deliverable ? "deliverable" : score >= 0.4 ? "risky" : "undeliverable";
          const badgeLabel = r.is_deliverable ? "Deliverable" : score >= 0.4 ? "Risky" : "Undeliverable";

          return `
            <div class="result-row">
              <span class="result-email">${escapeHtml(r.email)}</span>
              ${tierBadge}
              <span class="badge ${badgeClass}">${badgeLabel}</span>
              <span class="score ${scoreClass}">${(score * 100).toFixed(0)}%</span>
            </div>`;
        })
        .join("");

      resultsContainer.innerHTML = `<div class="results">${header}${rows}</div>`;
    }

    function escapeHtml(str) {
      const div = document.createElement("div");
      div.textContent = str;
      return div.innerHTML;
    }
  </script>
</body>
</html>
